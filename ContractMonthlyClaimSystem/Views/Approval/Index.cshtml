@model IEnumerable<ContractMonthlyClaimSystem.Models.Claim>
@{
    ViewData["Title"] = "Pending Claims For Coordinator";
}

<h2>Pending Claims</h2>

@if (TempData["Message"] is string m)
{
    <div class="alert alert-info">@m</div>
}

@if (!Model.Any())
{
    <div class="alert alert-success">No pending claims.</div>
}

@foreach (var c in Model)
{
    <div class="card mb-3">
        <div class="card-body d-flex justify-content-between align-items-start">
            <div>
                <h5>Claim #@c.Id — @c.LecturerName</h5>
                <div><strong>Month:</strong> @c.Month.ToString("MMMM yyyy")</div>
                <div><strong>Total:</strong> @c.TotalAmount.ToString("C") &nbsp; <strong>Hours:</strong> @c.TotalHours</div>
                <div><strong>Submitted:</strong> @c.SubmittedDate.ToString("MMM dd, yyyy")</div>

                @if (c.ClaimItems.Any())
                {
                    <div class="mt-2">
                        <strong>Work Items:</strong>
                        <ul class="mb-2">
                            @foreach (var item in c.ClaimItems)
                            {
                                <li>@item.Date.ToString("MM/dd/yyyy"): @item.Hours hours @(!string.IsNullOrEmpty(item.Description) ? $" - {item.Description}" : "")</li>
                            }
                        </ul>
                    </div>
                }

                @if (c.Documents.Any())
                {
                    <div class="mt-2">
                        <strong>Supporting Documents:</strong>
                        <div>
                            @foreach (var d in c.Documents)
                            {
                                <a class="btn btn-sm btn-outline-secondary me-2 mb-2"
                                   href="@Url.Action("DownloadDocument", "Claim", new { id = d.Id })"
                                   target="_blank"
                                   download="@d.OriginalFileName">
                                    @d.OriginalFileName
                                </a>
                            }
                        </div>
                    </div>
                }
            </div>
            <div>
                <form asp-action="Approve" method="post" class="d-inline">
                    <input type="hidden" name="id" value="@c.Id" />
                    <input type="hidden" name="role" value="Coordinator" />
                    <button class="btn btn-success">Approve</button>
                </form>
                <form asp-action="Reject" method="post" class="d-inline ms-2">
                    <input type="hidden" name="id" value="@c.Id" />
                    <input name="reason" type="hidden" value="Not specified" />
                    <button class="btn btn-danger">Reject</button>
                </form>
            </div>
        </div>
    </div>
}